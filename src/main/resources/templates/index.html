<!--
  Created by IntelliJ IDEA.
  User: heowonjae
  Date: 2025. 9. 1.
  Time: 09:35
  To change this template use File | Settings | File Templates.
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEMO</title>
  <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      background-color: #000;
      color: #ffffff; /* 전역 텍스트 색상 설정 */
    }

    #container {
      width: 100vw;
      height: 100vh;
    }

    #title-container {
      position: absolute;
      top: 45%; /* 타이핑 텍스트 위치 */
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    #typing-text {
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
      border-right: 0.15em solid #ffffff; /* 깜빡이는 커서 효과를 위해 초기 상태 설정 */
    }

    /* 텍스트가 모두 타이핑된 후에 커서가 깜빡이도록 CSS 애니메이션 적용 */
    .blinking-cursor {
      animation: blink-caret .75s step-end infinite;
    }

    #start-button {
      position: absolute;
      top: 60%; /* 버튼 위치를 아래로 내렸습니다 */
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 1rem 3rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: #ffffff;
      background-color: rgba(0, 0, 0, 0.05); /* 배경을 더 투명하게 변경 */
      border: 1px solid #ffffff;
      border-radius: 50px;
      backdrop-filter: blur(5px);
      cursor: pointer;
      /* 버튼이 처음에는 보이지 않도록 설정 */
      opacity: 0;
      /* 버튼이 부드럽게 나타나는 효과 추가 */
      transition: opacity 1s ease-in-out;
      z-index: 10;
    }

    #start-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
      transform: translate(-50%, -50%) scale(1.1);
    }

    /* 텍스트 깜박임 효과를 위한 CSS 애니메이션 */
    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: #ffffff; }
    }
  </style>
</head>
<body>
<div id="container"></div>
<div id="title-container">
  <span id="typing-text"></span>
</div>
<button id="start-button">시작하기</button>

<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script th:inline="javascript">
  window.onload = function () {
    const container = document.getElementById('container');
    const startButton = document.getElementById('start-button');
    const typingText = document.getElementById('typing-text');

    let scene, camera, renderer, earth, atmosphere, stars;
    // 마우스 컨트롤을 위한 변수 추가
    let isMousePressed = false;
    let mouseX = 0, mouseY = 0;
    const rotationSpeed = 0.005;

    // 초기화 함수
    function init() {
      // 씬(Scene) 생성
      scene = new THREE.Scene();

      // 카메라(Camera) 생성
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 2;

      // 렌더러(Renderer) 생성
      renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x000000, 1); // 배경 검은색으로 설정
      container.appendChild(renderer.domElement);

      // 페이지 로드 시 별과 지구를 바로 생성하고 보이게 합니다.
      createStars();
      createEarth();

      // 창 크기가 변경될 때 렌더러와 카메라를 업데이트
      window.addEventListener('resize', onWindowResize, false);

      // 마우스 이벤트를 위한 리스너 추가
      document.addEventListener('mousedown', onMouseDown, false);
      document.addEventListener('mouseup', onMouseUp, false);
      document.addEventListener('mousemove', onMouseMove, false);

      // 애니메이션 루프 시작
      animate();

      // 페이지 로드 후 타이핑 효과 시작
      startTypingEffect();
    }

    // 별 생성 함수
    function createStars() {
      const starGeometry = new THREE.BufferGeometry();
      const starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1.0 // 별의 크기를 키웠습니다
      });

      const starVertices = [];
      for (let i = 0; i < 5000; i++) { // 별의 개수를 줄여 성능 개선
        const x = THREE.MathUtils.randFloatSpread(500);
        const y = THREE.MathUtils.randFloatSpread(500);
        const z = THREE.MathUtils.randFloatSpread(500);
        starVertices.push(x, y, z);
      }
      starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));

      stars = new THREE.Points(starGeometry, starMaterial);
      scene.add(stars);
    }

    // 지구 모델 생성 함수
    function createEarth() {
      const textureLoader = new THREE.TextureLoader();
      const earthRadius = 1;

      // 지구 모델 생성
      const earthGeometry = new THREE.SphereGeometry(earthRadius, 64, 64);
      const earthMaterial = new THREE.MeshPhongMaterial({
        map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/r128/examples/textures/planets/earth_atmos_2048.jpg'),
        bumpMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/r128/examples/textures/planets/earth_bump_2048.jpg'),
        specularMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/r128/examples/textures/planets/earth_specular_2048.jpg'),
        bumpScale: 0.04,
        shininess: 15
      });
      earth = new THREE.Mesh(earthGeometry, earthMaterial);
      scene.add(earth);

      // 대기권 효과 생성
      const atmosphereGeometry = new THREE.SphereGeometry(earthRadius * 1.02, 64, 64);
      const atmosphereMaterial = new THREE.MeshLambertMaterial({
        color: 0x00ffff,
        transparent: true,
        opacity: 0.1,
        side: THREE.BackSide
      });
      atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
      scene.add(atmosphere);

      // 조명 추가
      const ambientLight = new THREE.AmbientLight(0x404040);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(5, 3, 5);
      scene.add(directionalLight);
    }

    // 창 크기가 변경될 때 렌더러와 카메라를 업데이트
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // 마우스 컨트롤 함수 추가
    function onMouseDown(event) {
      isMousePressed = true;
      mouseX = event.clientX;
      mouseY = event.clientY;
    }

    function onMouseUp(event) {
      isMousePressed = false;
    }

    function onMouseMove(event) {
      if (isMousePressed) {
        const deltaX = event.clientX - mouseX;
        const deltaY = event.clientY - mouseY;
        earth.rotation.y += deltaX * rotationSpeed;
        earth.rotation.x += deltaY * rotationSpeed;
        mouseX = event.clientX;
        mouseY = event.clientY;
      }
    }

    // 타이핑 효과 함수 (JavaScript로 재작성)
    function startTypingEffect() {
      const text = "글로벌 기업 SEMO";
      let i = 0;
      const speed = 100; // 텍스트가 나타나는 속도 (ms)

      // 타이핑 시작 전에 커서를 보이게 함
      typingText.style.borderRightColor = '#ffffff';

      function type() {
        if (i < text.length) {
          typingText.textContent += text.charAt(i);
          i++;
          setTimeout(type, speed);
        } else {
          // 타이핑이 끝난 후 커서 깜박임 애니메이션 적용
          typingText.classList.add('blinking-cursor');

          // 타이핑 완료 후 버튼을 보이게 함
          setTimeout(() => {
            startButton.style.opacity = '1';
          }, 500); // 0.5초 후 버튼 나타나기 시작
        }
      }

      // 타이핑 함수 시작
      type();
    }

    // 애니메이션 루프
    function animate() {
      requestAnimationFrame(animate);

      // 지구와 대기권, 별들이 항상 회전하도록 변경했습니다.
      if (earth) { // 지구가 생성된 후에만 회전
        earth.rotation.y += 0.002;
        atmosphere.rotation.y += 0.002;
      }
      stars.rotation.y += 0.0005;

      renderer.render(scene, camera);
    }

    // '시작하기' 버튼 클릭 이벤트 리스너.
    startButton.addEventListener('click', () => {
      const url = [[@{/main}]];
      location.href = url;
    });

    init();
  };
</script>
</body>
</html>